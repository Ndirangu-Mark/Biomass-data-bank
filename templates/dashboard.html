<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" dir="ltr">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="static/css/dashboard.css" rel="stylesheet">
    <!-- Fontawesome CDN -->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css.map">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/FontAwesome.otf">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.eot">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.svg">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.ttf">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2">
     <!-- Apexchart JS -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- Chart JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Threejs and TDSLoader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/TDSLoader.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.4.0/ol.css">
    <!-- Material Icon CDN -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Archip Font CDN -->
    <link href="https://fonts.cdnfonts.com/css/arkhip" rel="stylesheet">
    <!-- Include Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <!-- Include Plotly.js library -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.awesome-markers/2.0.4/leaflet.awesome-markers.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.awesome-markers/2.0.4/leaflet.awesome-markers.js"></script>

</head>
<body>
    <div class="container">
        <!-- *********** Sidebar ********** -->
        <aside>
            <div class="top">
                <div class="logo">
                    <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 473.02 511.76"><path fill-rule="nonzero" d="M295.19 225.4c1.01 7.88-4.72 15.18-12.81 16.31-8.09 1.14-15.47-4.33-16.48-12.2-1.27-9.88-6.46-16.13-13.11-19.07-8.62-3.79-19.45-2.6-27.69 1.57-9.28 4.71-16.69 13.82-17.75 26.85-.88 10.83 1.84 21.41 7.4 30.69 6.17 10.3 15.26 18.4 25.68 24.23 16.3 9.11 33.06 11.66 48.47 9.3 17.05-2.61 32.66-11.18 44.4-23.52 8.94-9.41 15.63-20.99 18.97-33.77 3.12-11.89 3.36-24.9-.13-38.25l-.52-1.96c-8.71-31.27-28.89-56.11-54.67-71.05-57.13-33.14-129.12-12.08-161.65 44.79-39.53 69.14-1.35 154.36 63.54 192.02 35.35 20.5 78.39 27.53 121 16.39l2.69-.71c87.46-24.46 138.37-115.77 115.51-203.23l-.87-3.22c-15.18-54.65-50.46-98.05-95.53-124.19l-.05.02c-70.99-41.2-158.8-35.41-224.17 12.33-20.51 14.98-38.03 33.56-51.87 54.58-53.67 81.53-45.28 179.1 11.52 255.61 18.06 24.34 40.61 45.75 66.41 62.73 56.02 36.89 127.34 52.71 201.28 32.27 7.87-2.21 15.97 2.2 18.09 9.83 2.12 7.64-2.54 15.63-10.41 17.84-83.12 22.99-163.13 5.3-225.85-36-28.5-18.76-53.47-42.48-73.52-69.5-63.99-86.22-72.58-196.42-12.24-288.07 15.73-23.88 35.73-45.06 59.25-62.23C175.01-8.92 275.64-15.75 357.05 31.5c51.24 29.79 91.35 79.02 108.58 140.92l1.01 3.69c26.89 102.9-33.66 209.84-136.33 238.55l-3.24.9c-50.64 13.24-101.71 4.92-143.58-19.37-78.63-45.62-121.35-147.6-73.94-230.51 40.72-71.2 131.29-97.47 202.76-56.01 31.99 18.56 57 49.23 67.78 87.76l.66 2.43c4.77 18.27 4.41 36.16.11 52.6-4.63 17.67-13.83 33.63-26.12 46.55-16.22 17.05-37.9 28.91-61.68 32.55-21.79 3.34-45.21-.13-67.67-12.67-14.63-8.18-27.61-20.05-36.26-34.48-8.66-14.45-12.56-30.51-11.18-47.32 1.98-24.36 16.16-41.55 33.97-50.57 16.39-8.32 36.42-9.88 53.42-2.37 15.33 6.77 27.17 20.36 29.85 41.25z"/></svg>
                    <h2 class="success"><span>Biomass </span>Flux</h2>
                </div>
                <button class="close secondary" id="close-btn">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="sidebar">
                <a class="active" href="#">
                    <i class="fa-solid fa-table-columns" id="dashboard-icon"></i>
                    <h3>Dashboard</h3>
                </a>
                <a href="/">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <h3>Exit</h3>
                </a>
            </div>
            
        </aside>


        <!-- ********** MAIN ******** -->
        <main>
            <!-- ********* NAVBAR ******** -->
            <nav>
                <button id="menu-btn">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <h3>Welcome back, User!</h3>
            </nav>
            <!-- ********* TOP CARDS ********* -->
            <div class="content">
                <div class="data">
                    <h2>Biomass</h2>
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 448 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M210.6 5.9L62 169.4c-3.9 4.2-6 9.8-6 15.5C56 197.7 66.3 208 79.1 208l24.9 0L30.6 281.4c-4.2 4.2-6.6 10-6.6 16C24 309.9 34.1 320 46.6 320L80 320 5.4 409.5C1.9 413.7 0 419 0 424.5c0 13 10.5 23.5 23.5 23.5L192 448l0 32c0 17.7 14.3 32 32 32s32-14.3 32-32l0-32 168.5 0c13 0 23.5-10.5 23.5-23.5c0-5.5-1.9-10.8-5.4-15L368 320l33.4 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16L344 208l24.9 0c12.7 0 23.1-10.3 23.1-23.1c0-5.7-2.1-11.3-6-15.5L237.4 5.9C234 2.1 229.1 0 224 0s-10 2.1-13.4 5.9z"/></svg>
                         <h1 class="success">4.92 t ha-1</h1>
                    </span>
                </div>
                <div class="data">
                    <h2>Green Space</h2>
                    <span>
                        <?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 119.4 122.88" style="enable-background:new 0 0 119.4 122.88" xml:space="preserve"><g><path d="M78.62,17.22l36.71-16.95c1.45-0.66,3.14-0.03,3.8,1.42c0.17,0.38,0.28,0.79,0.28,1.21v94.23c0,1.11-0.62,2.04-1.52,2.52 l-37.74,22.79c-0.07,0.03-0.14,0.1-0.24,0.14l-0.03,0.03h-0.1c-0.35,0.17-0.73,0.24-1.1,0.24s-0.76-0.07-1.11-0.24h-0.1l-0.03-0.03 c-0.07-0.03-0.17-0.07-0.24-0.14l-36.39-21.96l-36.43,22c-1.35,0.83-3.14,0.38-3.94-0.97C0.14,121.05,0,120.53,0,120.01V20.39 c0-1.24,0.76-2.28,1.86-2.69L39.61,0.3h0.07l0.07-0.03h0.03c0.28-0.1,0.55-0.17,0.86-0.17h0.35c0.28,0.03,0.59,0.07,0.86,0.17h0.03 l0.07,0.03h0.07l36.71,16.95L78.62,17.22L78.62,17.22z M37.84,95.49V7.37L5.7,22.22v92.68L37.84,95.49L37.84,95.49L37.84,95.49z M75.76,114.9V22.22L43.61,7.37v88.12L75.76,114.9L75.76,114.9z M113.67,7.37L81.53,22.22v92.68l32.15-19.41V7.37L113.67,7.37z"/></g></svg>
                        <h1 class="success">0.4308 km²</h1>
                    </span>
                </div>
                <div class="data">
                    <h2>Carbon Quantity</h2>
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 640 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M32 144c0 79.5 64.5 144 144 144l123.3 0c22.6 19.9 52.2 32 84.7 32s62.1-12.1 84.7-32l27.3 0c61.9 0 112-50.1 112-112s-50.1-112-112-112c-10.7 0-21 1.5-30.8 4.3C443.8 27.7 401.1 0 352 0c-32.6 0-62.4 12.2-85.1 32.3C242.1 12.1 210.5 0 176 0C96.5 0 32 64.5 32 144zM616 368l-336 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l336 0c13.3 0 24-10.7 24-24s-10.7-24-24-24zm-64 96l-112 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l112 0c13.3 0 24-10.7 24-24s-10.7-24-24-24zm-192 0L24 464c-13.3 0-24 10.7-24 24s10.7 24 24 24l336 0c13.3 0 24-10.7 24-24s-10.7-24-24-24zM224 392c0-13.3-10.7-24-24-24L96 368c-13.3 0-24 10.7-24 24s10.7 24 24 24l104 0c13.3 0 24-10.7 24-24z"/></svg>
                        <h1 class="success">2.31 t ha-1</h1>
                    </span>
                </div>
            </div>

            <!-- ********** SECTION ******** -->
            
            <section>
                <div class="segment">
                    <div class="leftContainer">
                        <div class="details">
                            <h2>Project Details</h2>
                            <small>JKUAT Biomass Estimation Study</small>
                            <span class="variables">
                                <span class="category1">
                                    <h5>Remote Sensing Method</h5>
                                    <h6 class="success">UAV RGB Analysis</h6>
                                </span>
                                <span class="category2">
                                    <h5>Model Applied</h5>
                                    <h6 class="success">Random Forest Algorithm</h6>
                                </span>
                            </span>
                            <h3>Data Sources</h3>
                            <span class="receiver">
                                <img src="static/images/jkuat.png" alt="JKUAT Campus" class="profile-photo">
                                <span class="contact">
                                    <h5>UAV RGB Integration</h5>
                                    <h6>Region: Juja, Kenya</h6>
                                </span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 320 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M16 144a144 144 0 1 1 288 0A144 144 0 1 1 16 144zM160 80c8.8 0 16-7.2 16-16s-7.2-16-16-16c-53 0-96 43-96 96c0 8.8 7.2 16 16 16s16-7.2 16-16c0-35.3 28.7-64 64-64zM128 480l0-162.9c10.4 1.9 21.1 2.9 32 2.9s21.6-1 32-2.9L192 480c0 17.7-14.3 32-32 32s-32-14.3-32-32z"/></svg>
                            </span>
                        </div>
                        
                        <!-- Statistics -->
                        <div class="statistics">
                            <h2>Accuracy</h2>
                            <div class="key">
                                <span class="current">UAV Imagery</span>
                            </div>
                            <div class="progress">
                                <div class="circle" data-degree="83" data-color="#1caa5cf5">
                                    <h2 class="number">83%</h2>
                                    <!-- <h4>LiDAR</h4> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="rightContainer">
                        <div class="upper-container">
                                <!-- </div> -->
                                <div class="card2">
                                    <!-- Div for the Plotly chart -->
                                    <div id="importanceChart" style="width: 100%; height: 250px;"></div>
                                </div>
                        </div>
                        
                        <div class="lower-container">
                            <span>
                                <h2>Observed Field Tree</h2>
                                <small class="text-muted">Sampled data</small>
                            </span>
                            <div class="specs-container">
                                <span>
                                    <h5 class="success" >Species</h5>
                                    <h4 class="speciesName">{{ species }}</h4>
                                </span>
                                <span>
                                    <h5 class="success" >Coordinates</h5>
                                    <h4 class="coordinates">{{ coordinates }}</h4>
                                </span>
                                <span>
                                    <h5 class="success">Height</h5>
                                    <h4 class="treeHeight">{{ height }}m</h4>
                                </span>
                                <span>
                                    <h5 class="success">Observed Biomass</h5>
                                    <h4 class="biomassValue">{{ biomass }}kg/m²</h4>
                                </span>
                            </div> 
                        </div>
                    </div>
                </div>
                <!-- Map -->
                <div class="carousel">
                    <div class="carousel-slides">
                        <div class="slide active">
                            <div class="map" id="map">
                                <h2>Biomass</h2>
                            </div>
                        </div>
                        <div class="slide">
                            <div class="map" id="map2">
                                <h2>Carbon Pool</h2>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control prev" onclick="prevSlide()">‹</button>
                    <button class="carousel-control next" onclick="nextSlide()">›</button>
                </div>
            </section>

        </main>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-geotiff@2.0.0/leaflet-geotiff.min.js"></script>
    <script>
        const map = L.map('map').setView([-1.0913, 37.0123], 15);

        // OpenStreetMap base layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        

        // Add a marker
        L.marker([{{ lat }}, {{ lon }}])
            .addTo(map)
            .bindPopup('{{ species }}: {{ biomass }}kg/m²');

        // Add the overlay image
        const imageUrl = 'https://github.com/Ndirangu-Mark/Biomass/blob/main/categorized_biomass.png?raw=true'; 
        const imageBounds = [[-1.101873, 37.003058], [-1.081462, 37.020062]];
        L.imageOverlay(imageUrl, imageBounds).addTo(map);
        map.fitBounds(imageBounds);

        // legend
        const legend2 = L.control({ position: 'bottomleft' });

        legend2.onAdd = function () {
            const div = L.DomUtil.create('div', 'legend');

            // Title
            div.innerHTML += '<div class="legend-title">Biomass (kg/m²)</div>';

            // Gradient bar
            div.innerHTML += '<div class="legend-bar2"></div>';

            // Labels
            const minValue = 6.62;
            const maxValue = 849.62;
            div.innerHTML += `
                <div class="legend-labels">
                    <span>${maxValue.toFixed(2)}</span>
                    <span>${minValue.toFixed(2)}</span>
                    
                </div>
            `;

            return div;
        };

        legend2.addTo(map);

    </script>
    <script>
        const map2 = L.map('map2').setView([-1.0913, 37.0123], 15);

        // OpenStreetMap base layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map2);
        

        // Add a marker
        L.marker([{{ lat }}, {{ lon }}])
            .addTo(map2)
            .bindPopup('{{ species }}: {{ biomass }}kg/m²');

        // Add the overlay image
        const imageUrl2 = 'https://github.com/Ndirangu-Mark/Biomass/blob/main/carbon%20flux.png?raw=true'; 
        const imageBounds2 = [[-1.101873, 37.003058], [-1.081462, 37.020062]];
        L.imageOverlay(imageUrl2, imageBounds2).addTo(map2);
        map.fitBounds(imageBounds2);

        // legend
        const legend = L.control({ position: 'bottomleft' });

        legend.onAdd = function () {
            const div = L.DomUtil.create('div', 'legend');

            // Title
            div.innerHTML += '<div class="legend-title">Biomass (kg/m²)</div>';

            // Gradient bar
            div.innerHTML += '<div class="legend-bar"></div>';

            // Labels
            const minValue = 3.21;
            const maxValue = 399.32;
            div.innerHTML += `
                <div class="legend-labels">
                    <span>${maxValue.toFixed(2)}</span>
                    <span>${minValue.toFixed(2)}</span>
                    
                </div>
            `;

            return div;
        };

        legend.addTo(map2);

    </script>

    <script src="https://cdn.jsdelivr.net/npm/ol@7.4.0/dist/ol.js"></script>
    <script src="static/js/dashboard.js"></script>
    
</body>
</html>